{% extends "layout.html" %}

{% block head %}
<meta property="og:type" content="website">
<meta property="og:title" content="ë‚˜ì˜ ê°œë°œì MBTIëŠ”? {{ mbti }} - {{ result.title }}">
<meta property="og:description" content="{{ result.desc }}">
<meta property="og:image" content="{{ og_image_url if og_image_url else url_for('static', filename='logo/communa_logo.svg', _external=True) }}">
<meta property="og:image:width" content="800">
<meta property="og:image:height" content="400">
{% endblock %}

{% block content %}
<style>
    /* Communa ë¸Œëœë“œ ì»¬ëŸ¬ */
    :root {
        --communa-primary: #20828A;
        --communa-hover: #186b72;
        --communa-gradient: linear-gradient(135deg, #20828A 0%, #6cdbeb 100%);
    }

    /* ê²°ê³¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .result-card {
        border: none;
        border-radius: 30px;
        box-shadow: 0 15px 35px rgba(32, 130, 138, 0.15);
        overflow: hidden;
        background-color: white;
        animation: fadeInUp 0.6s ease-out;
    }

    .result-header {
        background: var(--communa-gradient);
        color: white;
        padding: 3rem 1rem;
        position: relative;
    }

    .result-img-container {
        margin-top: -50px; /* í—¤ë” ìœ„ë¡œ ì‚´ì§ ê²¹ì¹˜ê²Œ */
        margin-bottom: 20px;
    }

    .result-img {
        width: 180px;
        height: 180px;
        object-fit: cover;
        border-radius: 50%;
        border: 6px solid white;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        background-color: #fff;
    }

    .text-communa {
        color: var(--communa-primary);
    }

    .btn-share {
        background-color: #333;
        color: white;
        border: none;
        transition: all 0.3s ease;
    }

    .btn-share:hover {
        background-color: black;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        color: white;
    }

    .btn-retry {
        color: #888;
        transition: color 0.2s;
    }
    .btn-retry:hover {
        color: var(--communa-primary);
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

<div class="container py-5" style="max-width: 600px;">

    <div class="result-card text-center">
        <div class="result-header">
            <h5 class="mb-1 opacity-75 fw-light">ë‹¹ì‹ ì˜ ê°œë°œì ìœ í˜•ì€?</h5>
            <h1 class="display-3 fw-bold mb-0" style="letter-spacing: 2px;">{{ mbti }}</h1>
        </div>

        <div class="card-body p-4 p-md-5 pt-0">
            <div class="result-img-container">
                <img src="{{ url_for('static', filename='mbti/' + mbti + '.png') }}"
                     class="result-img animate__animated animate__bounceIn"
                     alt="{{ mbti }} ìºë¦­í„°"
                     onerror="this.style.display='none'; document.getElementById('fallback-emoji').style.display='block';">

                <div id="fallback-emoji" style="display:none; font-size: 80px; margin-top: 40px;">ğŸ‘¾</div>
            </div>

            <h2 class="fw-bold text-communa mb-2">{{ result.animal }}</h2>
            <h4 class="fw-bold text-dark mb-4">"{{ result.title }}"</h4>

            <p class="lead text-secondary mb-5 lh-lg" style="word-break: keep-all; font-size: 1.05rem;">
                {{ result.desc }}
            </p>

            <hr class="my-4 opacity-25">

            <div class="d-grid gap-3 col-10 mx-auto mb-4">
                <button onclick="shareResult()" class="btn btn-share rounded-pill fw-bold py-3 shadow-sm d-flex align-items-center justify-content-center">
                    <i class="bi bi-share-fill me-2"></i>
                    <span id="shareBtnText">ê²°ê³¼ ê³µìœ í•˜ê¸°</span>
                </button>
            </div>

            <div class="mt-3">
                <a href="/mbti" class="btn btn-retry text-decoration-none fw-bold">
                    <i class="bi bi-arrow-counterclockwise me-1"></i> ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°
                </a>
            </div>
        </div>
    </div>

</div>

<script>
    // 1. ê³µìœ í•  ë°ì´í„° ì¤€ë¹„
    // í˜„ì¬ URL (ì´ë¯¸ type íŒŒë¼ë¯¸í„°ê°€ í¬í•¨ë˜ì–´ ìˆìŒ)
    const shareUrl = window.location.href;
    const shareTitle = "ë‚˜ì˜ ê°œë°œì MBTIëŠ”? [{{ mbti }} - {{ result.title }}]";
    const shareText = "{{ result.desc }}";

    // 2. í†µí•© ê³µìœ  í•¨ìˆ˜
    async function shareResult() {
        if (navigator.share) {
            // ëª¨ë°”ì¼ (Web Share API)
            try {
                await navigator.share({
                    title: shareTitle,
                    text: shareText,
                    url: shareUrl,
                });
            } catch (err) {
                console.log('ê³µìœ  ì·¨ì†Œë¨');
            }
        } else {
            // PC (í´ë¦½ë³´ë“œ ë³µì‚¬)
            try {
                await navigator.clipboard.writeText(shareUrl);
                alert('ê²°ê³¼ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! \nì¹´ì¹´ì˜¤í†¡ì´ë‚˜ ë©”ì‹ ì €ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
            } catch (err) {
                prompt('ì´ ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”:', shareUrl);
            }
        }
    }

    // PC ì ‘ì† ì‹œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    document.addEventListener("DOMContentLoaded", function() {
        if (!navigator.share) {
            document.getElementById('shareBtnText').innerText = "ê²°ê³¼ ë§í¬ ë³µì‚¬í•˜ê¸°";
        }
    });
</script>
{% endblock %}