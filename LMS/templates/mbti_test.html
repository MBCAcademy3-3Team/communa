{% extends "layout.html" %}

{% block title %}Communa - ê°œë°œì ì„±í–¥ í…ŒìŠ¤íŠ¸{% endblock %}

{% block content %}
<style>
    /* Communa ë¸Œëœë“œ ì»¬ëŸ¬ ì •ì˜ */
    :root {
        --communa-primary: #20828A;
        --communa-hover: #186b72;
        --communa-light: rgba(32, 130, 138, 0.1);
    }

    /* 1. í”„ë¡œê·¸ë ˆìŠ¤ ë°” (ìƒë‹¨ ê³ ì •) */
    .progress-container {
        position: sticky;
        top: 70px; /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ë†’ì´ ê³ ë ¤ */
        z-index: 99;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(5px);
        padding: 10px 0;
        margin-bottom: 20px;
    }

    .progress {
        height: 10px;
        border-radius: 5px;
        background-color: #e9ecef;
    }

    .progress-bar {
        background-color: var(--communa-primary);
        transition: width 0.3s ease;
    }

    /* 2. ì§ˆë¬¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .question-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        transition: transform 0.2s ease;
        background-color: #fff;
    }

    .question-card:hover {
        transform: translateY(-2px);
    }

    .question-badge {
        background-color: var(--communa-light);
        color: var(--communa-primary);
        padding: 5px 12px;
        border-radius: 12px;
        font-weight: bold;
        font-size: 0.9rem;
        display: inline-block;
        margin-bottom: 15px;
    }

    /* 3. ë‹µë³€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì»¤ìŠ¤í…€ ë¼ë””ì˜¤ ë²„íŠ¼) */
    .btn-answer {
        border: 2px solid #e9ecef;
        background-color: #fff;
        color: #495057;
        font-weight: 500;
        transition: all 0.2s ease;
        text-align: left;
        display: flex;
        align-items: center;
        width: 100%;
    }

    .btn-answer:hover {
        border-color: var(--communa-primary);
        background-color: #f8fcfc; /* ì•„ì£¼ ì—°í•œ í‹¸ìƒ‰ ë°°ê²½ */
        color: var(--communa-primary);
    }

    /* ì„ íƒë˜ì—ˆì„ ë•Œ ìŠ¤íƒ€ì¼ */
    .btn-check:checked + .btn-answer {
        background-color: var(--communa-primary);
        border-color: var(--communa-primary);
        color: #fff;
        box-shadow: 0 4px 10px rgba(32, 130, 138, 0.3);
        transform: scale(1.01);
    }

    /* ì²´í¬ ì•„ì´ì½˜ (ì„ íƒ ì‹œ ë³´ì„) */
    .check-icon {
        opacity: 0;
        margin-right: 10px;
        transition: opacity 0.2s;
        font-size: 1.2rem;
    }

    .btn-check:checked + .btn-answer .check-icon {
        opacity: 1;
    }

    /* 4. ì œì¶œ ë²„íŠ¼ */
    .btn-submit {
        background-color: var(--communa-primary);
        border: none;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-submit:hover {
        background-color: var(--communa-hover);
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(32, 130, 138, 0.2);
    }
</style>

<div class="container py-5" style="max-width: 700px;">

    <div class="text-center mb-5">
        <span class="badge rounded-pill bg-light text-secondary border mb-2 px-3">Dev Type Test</span>
        <h1 class="fw-bold mb-2" style="color: #333;">ğŸ’» ê°œë°œì MBTI í…ŒìŠ¤íŠ¸</h1>
        <p class="text-muted">ìƒí™©ë³„ ë¬¸ë‹µì„ í†µí•´ ë‚˜ì˜ ì½”ë”© ì„±í–¥ì„ ì•Œì•„ë³´ì„¸ìš”.</p>
    </div>

    <div class="progress-container rounded-3">
        <div class="d-flex justify-content-between small text-muted mb-1 px-1">
            <span>Progress</span>
            <span id="progressText">0%</span>
        </div>
        <div class="progress shadow-sm">
            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
        </div>
    </div>

    <form action="/mbti/result" method="POST" id="mbtiForm">
        {% for q in questions %}
        <div class="card question-card mb-5" id="card_q{{ q.id }}">
            <div class="card-body p-4 p-md-5">
                <div class="question-badge">Q{{ loop.index }}</div>
                <h4 class="mb-4 fw-bold lh-base" style="word-break: keep-all;">{{ q.question }}</h4>

                <div class="d-grid gap-3">
                    {% for ans in q.answers %}
                    <div class="position-relative">
                        <input type="radio" class="btn-check"
                               name="{{ q.id }}"
                               id="q{{ q.id }}_{{ ans.type }}"
                               value="{{ ans.type }}"
                               required
                               onchange="updateProgress()">

                        <label class="btn btn-answer p-3 rounded-4" for="q{{ q.id }}_{{ ans.type }}">
                            <i class="bi bi-check-circle-fill check-icon"></i>
                            <span class="fs-6">{{ ans.text }}</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}

        <div class="d-grid mt-5 pb-5">
            <button type="submit" class="btn btn-submit btn-lg rounded-pill fw-bold p-3 shadow-sm">
                ê²°ê³¼ ë¶„ì„í•˜ê¸° ğŸš€
            </button>
        </div>
    </form>
</div>

<script>
    function updateProgress() {
        const totalQuestions = {{ questions|length }};
        // ì²´í¬ëœ ë¼ë””ì˜¤ ë²„íŠ¼ì˜ ê°œìˆ˜ë¥¼ ì…‰ë‹ˆë‹¤.
        const answeredCount = document.querySelectorAll('.btn-check:checked').length;

        // í¼ì„¼íŠ¸ ê³„ì‚°
        const percent = Math.round((answeredCount / totalQuestions) * 100);

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('progressText').innerText = percent + '%';

        // (ì„ íƒì‚¬í•­) ë‹µë³€ í´ë¦­ ì‹œ ë‹¤ìŒ ë¬¸ì œë¡œ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤ ì´ë™
        // í˜„ì¬ í´ë¦­ëœ ìš”ì†Œì˜ ë¶€ëª¨ ì¹´ë“œ ì°¾ê¸°
        /* const currentInput = document.querySelector('.btn-check:checked:focus');
        if (currentInput) {
            const currentCard = currentInput.closest('.question-card');
            const nextCard = currentCard.nextElementSibling;
            if (nextCard && nextCard.classList.contains('question-card')) {
                setTimeout(() => {
                    nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        }
        */
    }
</script>
{% endblock %}